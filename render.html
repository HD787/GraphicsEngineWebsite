<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>graphics</title>
</head>
<link rel="stylesheet" href="render.css">

<body>
    <div class="row">
        <div class="column left">
            <canvas id="myCanvas" repetition="no-repeat"></canvas>
            <div>
                <button id="loadForest"> load Forest </button>
                <button id="loadCube"> load Cube </button>
                <a href="https://github.com/HD787/GraphicsEngineWebsite">checkout the source code</a>
            </div>
        </div>

        <div class="column right">
            <button class="toggleButton" id="controlsButton" data-target="controls">Controls</button>
            <button class="toggleButton" id="transformsButton" data-target="transforms">Transforms</button>
            <button class="toggleButton" id="RasterizationButtin" data-target="rasterization">Rasterization</button>
            <div id="controls">
                <h2>Controls</h2>
                <h3>W: Translate Up</h3>
                <h3>A: Translate Left</h3>
                <h3>S: Translate Down</h3>
                <h3>D: Translate Right</h3>
                <h3>C: Translate Forward</h3>
                <h3>Space: Translate Back</h3>
                <h3>E: Rotate Up About Y-Axis</h3>
                <h3>F: Rotate Down About Y-Axis</h3>
                <h3>R: Rotate Up About X-Axis</h3>
                <h3>G: Rotate Down About X-Axis</h3>
                <h3>T: Rotate Up About Z-Axis</h3>
                <h3>H: Rotate Down About Z-Axis</h3>
            </div>
        
            <div id="transforms" class="hidden"> 
                <h2>Transforms</h2>
                <p><a href="docs/matrices.html" target="_blank">Homogeneous Matrices</a></p>
                <div id="matrixInput">
                    <div>
                        <input type="number" value="1">
                        <input type="number" value="0">
                        <input type="number" value="0">
                        <input type="number" value="0">
                    </div>
                    <div>
                        <input type="number" value="0">
                        <input type="number" value="1">
                        <input type="number" value="0">
                        <input type="number" value="0">
                    </div>
                    <div>
                        <input type="number" value="0">
                        <input type="number" value="0">
                        <input type="number" value="1">
                        <input type="number" value="0">
                    </div>
                    <div>
                        <input type="number" value="0">
                        <input type="number" value="0">
                        <input type="number" value="0">
                        <input type="number" value="1">
                    </div>
                    <br>
                    <button onClick="submitNewMatrix()">Add Transform</button>
                </div>
                <br>
                <div>
                    <p><a href="docs/explode.html" target="_blank">Explode Model</a></p>
                    <input type="range" class="slider" min="-2.0" max="2.0" value="0.0" step="0.1" oninput="submitNewExplodeScalar(this.value)">
                    <span id="explodeScalarValue">0.0</span>
                </div>
             </div>

            <div id="rasterization" class="hidden">
                <h2>Rasterization</h2>
                <div>
                    <p><a href="docs/lighting.html" target="_blank">Lighting Vector</a></p>
                    <input id="x" value="0">
                    <input id="y" value="0">
                    <input id="z" value="-1">
                    <button onClick="submitNewLightVector(
                        document.getElementById('x').value,
                        document.getElementById('y').value,
                        document.getElementById('z').value)">
                        Update Vector</button>
                </div>
                <div>
                    <p><a href="docs/colors.html" target="_blank">RGB Values</a></p>
                    <input id="r" value="127">
                    <input id="g" value="127">
                    <input id="b" value="127">
                    <button 
                        onClick="submitNewColor( 
                        document.getElementById('r').value,
                        document.getElementById('g').value, 
                        document.getElementById('b').value)">
                        Change Color</button>
                </div>
                <br>
                <button id="renderWireFrame" onClick="changeRenderMode()">Disable Scanline</button>
            </div>            

        </div> 
    </div>



    <script src="WASM_forestDemo.js"></script>
    <script src="globalFuncs.js"></script>
    <script>
        var wcPtr, ctx, imageData;
        var initialize, renderPass, getFrameBuffer, initializeFromObj, deleteWebContext;
        var keyStates = {};
        var renderMode = 0;
        const canvas = document.getElementById('myCanvas');
        canvas.width = window.innerWidth / 1.8;
        canvas.height = window.innerHeight / 1.2;

        Module.onRuntimeInitialized = () => { 
            
            initialize = Module._initialize;
            initializeUtahTeapot = Module._initializeUtahTeapot;
            initializeFromObj = Module._initializeFromObj;
            renderPass = Module._renderPass; 
            getFrameBuffer = Module._getFrameBuffer;
            deleteWebContext = Module._deleteWebContext;
            renderPassWireFrame = Module._renderPassWireFrame;
            updateExplodeScalar = Module._updateExplodeScalar;
            updateColorBuffer = Module._updateColorBuffer;
            updateLightVector = Module._updateLightVector;
            addMatrixValue = Module._addMatrixValue;
            addMatrixSlot = Module._addMatrixSlot;
            //const misc = Module._misc;

            wcPtr = initialize(canvas.width, canvas.height);
            const pixelDataPtr = getFrameBuffer(wcPtr);
            const pixelData = new Uint8ClampedArray(Module.HEAPU8.buffer, pixelDataPtr, canvas.width * canvas.height * 4);
            ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            imageData = new ImageData(pixelData, canvas.width, canvas.height);
            render();
        };

        window.addEventListener('keydown', (event) => {
            keyStates[event.code] = true;
            transform();
        });

        window.addEventListener('keyup', (event) => {
            keyStates[event.code] = false;
        });

        document.getElementById('loadForest').addEventListener('click', function() {
            event.target.blur()
            deleteWebContext(wcPtr);
            wcPtr = initializeFromObj(canvas.width, canvas.height);
            const pixelDataPtr = getFrameBuffer(wcPtr);
            const pixelData = new Uint8ClampedArray(Module.HEAPU8.buffer, pixelDataPtr, canvas.width * canvas.height * 4);
            renderPass(wcPtr, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
            render()
        });

        document.getElementById('loadCube').addEventListener('click', function() {
            event.target.blur()
            deleteWebContext(wcPtr);
            wcPtr = initialize(canvas.width, canvas.height);
            const pixelDataPtr = getFrameBuffer(wcPtr);
            const pixelData = new Uint8ClampedArray(Module.HEAPU8.buffer, pixelDataPtr, canvas.width * canvas.height * 4);
            render();
        });

        document.querySelectorAll('.toggleButton').forEach(button => {
            button.addEventListener('click', changeMenus);
        });

        

    </script>
</body>
</html>